<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ—ï¸ Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ù‡Ù„Ø§Ù„ÙŠ Ù„Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            direction: rtl;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }
        
        .header h1 {
            color: #333;
            margin: 0 0 10px 0;
            font-size: 2.8rem;
            font-weight: 700;
        }
        
        .header p {
            color: #666;
            font-size: 1.2rem;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .test-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 25px;
            border-left: 6px solid #667eea;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .test-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .test-card h3 {
            margin-top: 0;
            color: #333;
            font-size: 1.3rem;
            margin-bottom: 15px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 140px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn.success { 
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        .btn.danger { 
            background: linear-gradient(135deg, #dc3545, #fd7e14);
        }
        .btn.warning { 
            background: linear-gradient(135deg, #ffc107, #fd7e14);
        }
        .btn.info { 
            background: linear-gradient(135deg, #17a2b8, #6f42c1);
        }
        
        .status {
            margin: 20px 0;
            padding: 20px;
            border-radius: 12px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            border: 2px solid transparent;
        }
        
        .status.success { 
            background: linear-gradient(135deg, #d4edda, #c3e6cb); 
            border-color: #28a745;
            color: #155724; 
        }
        
        .status.error { 
            background: linear-gradient(135deg, #f8d7da, #f5c6cb); 
            border-color: #dc3545;
            color: #721c24; 
        }
        
        .status.info { 
            background: linear-gradient(135deg, #d1ecf1, #bee5eb); 
            border-color: #17a2b8;
            color: #0c5460; 
        }
        
        .status.warning { 
            background: linear-gradient(135deg, #fff3cd, #ffeaa7); 
            border-color: #ffc107;
            color: #856404; 
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4aa, #00d4aa);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .system-health {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .health-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border-left: 5px solid #28a745;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .health-card.warning { border-left-color: #ffc107; }
        .health-card.error { border-left-color: #dc3545; }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .section-title {
            color: #333;
            font-size: 1.5rem;
            margin: 30px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .quick-actions {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
            text-align: center;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: right;
            border-bottom: 1px solid #dee2e6;
        }
        
        .data-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }
        
        .data-table tr:hover {
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—ï¸ Ù†Ø¸Ø§Ù… Ø§Ù„Ù‡Ù„Ø§Ù„ÙŠ Ù„Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª</h1>
            <p>Ù„ÙˆØ­Ø© Ø§Ø®ØªØ¨Ø§Ø± ÙˆÙ…Ø±Ø§Ù‚Ø¨Ø© Ø´Ø§Ù…Ù„Ø© Ù…ØªØ·ÙˆØ±Ø©</p>
        </div>

        <div id="status" class="status info">
            ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…...
            <div class="loading"></div>
        </div>

        <div class="system-health" id="systemHealth" style="display: none;">
            <div class="health-card" id="serverHealth">
                <h4>ğŸ–¥ï¸ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…</h4>
                <p id="serverStatus">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</p>
            </div>
            <div class="health-card" id="authHealth">
                <h4>ğŸ” Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©</h4>
                <p id="authStatus">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</p>
            </div>
            <div class="health-card" id="dataHealth">
                <h4>ğŸ’¾ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
                <p id="dataStatus">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</p>
            </div>
        </div>

        <div class="section-title">ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø³Ø±ÙŠØ¹Ø©</div>
        <div class="test-grid">
            <div class="test-card">
                <h3>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©</h3>
                <button class="btn" onclick="testLogin()">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
                <button class="btn danger" onclick="clearTokens()">Ù…Ø³Ø­ Ø§Ù„ØªÙˆÙƒÙŠÙ†Ø§Øª</button>
                <button class="btn warning" onclick="testAuth()">ÙØ­Øµ Ø§Ù„ØªÙˆÙƒÙŠÙ†</button>
            </div>

            <div class="test-card">
                <h3>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
                <button class="btn info" onclick="testDashboard()">ÙØ­Øµ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
                <button class="btn" onclick="testRealTimeUpdates()">Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙˆØ±ÙŠ</button>
            </div>

            <div class="test-card">
                <h3>ğŸš§ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h3>
                <button class="btn" onclick="testProjects()">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</button>
                <button class="btn success" onclick="testProjectDetails()">ØªÙØ§ØµÙŠÙ„ Ù…Ø´Ø±ÙˆØ¹</button>
                <button class="btn info" onclick="testProjectsByCountry()">Ù…Ø´Ø§Ø±ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆÙ„Ø©</button>
            </div>

            <div class="test-card">
                <h3>ğŸ—ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h3>
                <button class="btn" onclick="testSections()">Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</button>
                <button class="btn success" onclick="testSectionDetails()">ØªÙØ§ØµÙŠÙ„ Ù‚Ø³Ù…</button>
                <button class="btn info" onclick="testSectionsByProject()">Ø£Ù‚Ø³Ø§Ù… Ø­Ø³Ø¨ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button>
            </div>

            <div class="test-card">
                <h3>ğŸ’° Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3>
                <button class="btn" onclick="testSpendings()">Ø¹Ø±Ø¶ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</button>
                <button class="btn info" onclick="testSpendingsByProject()">Ù…ØµØ±ÙˆÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button>
                <button class="btn warning" onclick="testSpendingCategories()">ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª</button>
            </div>

            <div class="test-card">
                <h3>ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
                <button class="btn" onclick="testUsers()">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
                <button class="btn info" onclick="testCurrentUser()">Ø¨ÙŠØ§Ù†Ø§ØªÙŠ Ø§Ù„Ø´Ø®ØµÙŠØ©</button>
            </div>
        </div>

        <div class="quick-actions">
            <h3 class="section-title">âš¡ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø´Ø§Ù…Ù„Ø©</h3>
            <button class="btn success" onclick="runFullSystemTest()" style="font-size: 16px; padding: 15px 30px;">
                ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ Ù„Ù„Ù†Ø¸Ø§Ù…
            </button>
            <button class="btn info" onclick="runPerformanceTest()" style="font-size: 16px; padding: 15px 30px;">
                âš¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡
            </button>
            <button class="btn" onclick="openMainApp()" style="font-size: 16px; padding: 15px 30px;">
                ğŸš€ ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
            </button>
        </div>

        <div class="stats" id="stats" style="display: none;">
            <div class="stat-card">
                <div class="stat-number" id="projectCount">0</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="projectProgress" style="width: 0%;"></div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="sectionCount">0</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="sectionProgress" style="width: 0%;"></div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="spendingCount">0</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="spendingProgress" style="width: 0%;"></div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalBudget">0</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© (Ù…Ù„ÙŠÙˆÙ†)</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="budgetProgress" style="width: 0%;"></div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="spentAmount">0</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØµØ±Ù (Ù…Ù„ÙŠÙˆÙ†)</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="spentProgress" style="width: 0%;"></div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgProgress">0%</div>
                <div class="stat-label">Ù…ØªÙˆØ³Ø· ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="avgProgressBar" style="width: 0%;"></div>
                </div>
            </div>
        </div>

        <div id="detailsTable" style="display: none;">
            <div class="section-title">ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
            <table class="data-table" id="dataTable">
                <thead>
                    <tr id="tableHeader"></tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        let authToken = '';
        let systemData = {
            projects: [],
            sections: [],
            spendings: [],
            users: [],
            dashboard: {}
        };
        
        // Auto-check system on load
        window.addEventListener('load', async () => {
            await checkSystemHealth();
        });

        async function checkSystemHealth() {
            showStatus('ğŸ”„ ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…...', 'info');
            
            // Check server
            try {
                const response = await fetch('http://localhost:5000');
                if (response.ok) {
                    const data = await response.json();
                    updateHealthCard('serverHealth', 'success', `âœ… Ø§Ù„Ø®Ø§Ø¯Ù… ÙŠØ¹Ù…Ù„ - Ø§Ù„Ù†Ø³Ø®Ø© ${data.version}`);
                } else {
                    updateHealthCard('serverHealth', 'error', 'âŒ Ø§Ù„Ø®Ø§Ø¯Ù… Ù„Ø§ ÙŠØ³ØªØ¬ÙŠØ¨');
                }
            } catch (error) {
                updateHealthCard('serverHealth', 'error', 'âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
                showStatus('âŒ Ø§Ù„Ø®Ø§Ø¯Ù… ØºÙŠØ± Ù…ØªØ§Ø­. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ÙØ° 5000', 'error');
                return;
            }

            // Test login
            await testLoginSilent();
            
            // Check data
            if (authToken) {
                await loadAllData();
                updateHealthCard('dataHealth', 'success', `âœ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªÙˆÙØ±Ø© - ${systemData.projects.length} Ù…Ø´Ø§Ø±ÙŠØ¹`);
                showSystemHealth();
                showStatus('âœ… Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ø«Ø§Ù„ÙŠ! Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± ğŸš€', 'success');
                updateStats();
            }
        }

        function updateHealthCard(cardId, status, message) {
            const card = document.getElementById(cardId);
            card.className = `health-card ${status}`;
            const statusElement = card.querySelector('p');
            statusElement.textContent = message;
        }

        function showSystemHealth() {
            document.getElementById('systemHealth').style.display = 'grid';
        }

        async function testLoginSilent() {
            try {
                const response = await fetch('http://localhost:5000/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'password',
                        country: 'egypt'
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.success) {
                    authToken = data.token;
                    updateHealthCard('authHealth', 'success', `âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - ${data.user.name}`);
                    return true;
                } else {
                    updateHealthCard('authHealth', 'error', `âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ${data.message}`);
                    return false;
                }
            } catch (error) {
                updateHealthCard('authHealth', 'error', 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©');
                return false;
            }
        }

        async function loadAllData() {
            if (!authToken) return;

            try {
                const [projectsRes, sectionsRes, spendingsRes, usersRes, dashboardRes] = await Promise.all([
                    fetch('http://localhost:5000/api/projects', { headers: { 'Authorization': `Bearer ${authToken}` } }),
                    fetch('http://localhost:5000/api/sections', { headers: { 'Authorization': `Bearer ${authToken}` } }),
                    fetch('http://localhost:5000/api/spendings', { headers: { 'Authorization': `Bearer ${authToken}` } }),
                    fetch('http://localhost:5000/api/users', { headers: { 'Authorization': `Bearer ${authToken}` } }),
                    fetch('http://localhost:5000/api/dashboard', { headers: { 'Authorization': `Bearer ${authToken}` } })
                ]);

                systemData.projects = (await projectsRes.json()).data || [];
                systemData.sections = (await sectionsRes.json()).data || [];
                systemData.spendings = (await spendingsRes.json()).data || [];
                systemData.users = (await usersRes.json()).data || [];
                systemData.dashboard = await dashboardRes.json();

                return true;
            } catch (error) {
                console.error('Error loading data:', error);
                return false;
            }
        }

        function updateStats() {
            const projects = systemData.projects;
            const sections = systemData.sections;
            const spendings = systemData.spendings;

            document.getElementById('stats').style.display = 'grid';
            
            document.getElementById('projectCount').textContent = projects.length;
            document.getElementById('sectionCount').textContent = sections.length;
            document.getElementById('spendingCount').textContent = spendings.length;
            
            const totalBudget = projects.reduce((sum, p) => sum + (p.budget || 0), 0);
            const totalSpent = spendings.reduce((sum, s) => sum + (s.amount || 0), 0);
            const avgProgress = projects.length > 0 ? 
                Math.round(projects.reduce((sum, p) => sum + (p.progress || 0), 0) / projects.length) : 0;
            
            document.getElementById('totalBudget').textContent = (totalBudget / 1000000).toFixed(1);
            document.getElementById('spentAmount').textContent = (totalSpent / 1000000).toFixed(1);
            document.getElementById('avgProgress').textContent = avgProgress + '%';
            
            // Update progress bars
            document.getElementById('projectProgress').style.width = Math.min(projects.length * 10, 100) + '%';
            document.getElementById('sectionProgress').style.width = Math.min(sections.length * 5, 100) + '%';
            document.getElementById('spendingProgress').style.width = Math.min(spendings.length * 5, 100) + '%';
            document.getElementById('budgetProgress').style.width = Math.min((totalBudget / 1000000) * 2, 100) + '%';
            document.getElementById('spentProgress').style.width = totalBudget > 0 ? (totalSpent / totalBudget) * 100 + '%' : '0%';
            document.getElementById('avgProgressBar').style.width = avgProgress + '%';
        }

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = message;
        }

        async function testLogin() {
            try {
                showStatus('ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...', 'info');
                
                const response = await fetch('http://localhost:5000/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'password',
                        country: 'egypt'
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.success) {
                    authToken = data.token;
                    showStatus(`âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!

ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${data.user.name}
ğŸŒ Ø§Ù„Ø¯ÙˆÙ„Ø©: ${data.user.country}
ğŸ”‘ Ø§Ù„Ø¯ÙˆØ±: ${data.user.role}
ğŸ•’ Ø§Ù„ØªÙˆÙ‚ÙŠØª: ${new Date().toLocaleString('ar-EG')}`, 'success');
                    
                    updateHealthCard('authHealth', 'success', `âœ… Ù…ØµØ§Ø¯Ù‚Ø© Ù†Ø´Ø·Ø© - ${data.user.name}`);
                } else {
                    showStatus(`âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ${data.message}`, 'error');
                }
            } catch (error) {
                showStatus(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`, 'error');
            }
        }

        async function testProjects() {
            if (!authToken) {
                showStatus('âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }

            try {
                showStatus('ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹...', 'info');
                
                const response = await fetch('http://localhost:5000/api/projects', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();
                
                if (response.ok && data.success) {
                    const projects = data.data;
                    systemData.projects = projects;
                    
                    const egyptProjects = projects.filter(p => p.country === 'egypt');
                    const libyaProjects = projects.filter(p => p.country === 'libya');
                    const activeProjects = projects.filter(p => p.status === 'in-progress');
                    const completedProjects = projects.filter(p => p.status === 'completed');
                    
                    showStatus(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­!

ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:
â€¢ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ: ${projects.length} Ù…Ø´Ø±ÙˆØ¹
â€¢ Ù…ØµØ±: ${egyptProjects.length} Ù…Ø´Ø§Ø±ÙŠØ¹
â€¢ Ù„ÙŠØ¨ÙŠØ§: ${libyaProjects.length} Ù…Ø´Ø§Ø±ÙŠØ¹
â€¢ Ø§Ù„Ù†Ø´Ø·Ø©: ${activeProjects.length} Ù…Ø´Ø§Ø±ÙŠØ¹
â€¢ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©: ${completedProjects.length} Ù…Ø´Ø§Ø±ÙŠØ¹

ğŸ—ï¸ Ø£Ù…Ø«Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹:
${projects.slice(0, 3).map(p => `â€¢ ${p.name} (${p.status === 'in-progress' ? 'Ø¬Ø§Ø±ÙŠ' : 'Ù…ÙƒØªÙ…Ù„'}) - ${(p.budget / 1000000).toFixed(1)} Ù…Ù„ÙŠÙˆÙ†`).join('\n')}`, 'success');
                    
                    updateStats();
                    showProjectsTable(projects);
                } else {
                    showStatus(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹: ${data.message}`, 'error');
                }
            } catch (error) {
                showStatus(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹: ${error.message}`, 'error');
            }
        }

        async function testProjectDetails() {
            if (!authToken) {
                showStatus('âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }

            try {
                showStatus('ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹...', 'info');
                
                // Get projects first
                const projectsRes = await fetch('http://localhost:5000/api/projects', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const projectsData = await projectsRes.json();
                
                if (projectsData.success && projectsData.data.length > 0) {
                    const testProject = projectsData.data[0];
                    
                    const response = await fetch(`http://localhost:5000/api/projects/${testProject._id}`, {
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });

                    const data = await response.json();
                    
                    if (response.ok && data.success) {
                        const project = data.data;
                        showStatus(`âœ… ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù…Ø­Ø¯Ø«Ø©!

ğŸ“‹ ${project.name}
ğŸ—ï¸ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…: ${project.sectionsCount || 0}
ğŸ’° Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©: ${(project.budget / 1000000).toFixed(1)} Ù…Ù„ÙŠÙˆÙ†
ğŸ’¸ Ø§Ù„Ù…Ù†ØµØ±Ù: ${(project.totalSpent / 1000000).toFixed(1)} Ù…Ù„ÙŠÙˆÙ†
ğŸ’µ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${(project.remainingBudget / 1000000).toFixed(1)} Ù…Ù„ÙŠÙˆÙ†
ğŸ“ˆ Ø§Ù„ØªÙ‚Ø¯Ù…: ${project.actualProgress || project.progress}%
ğŸŒ Ø§Ù„Ø¯ÙˆÙ„Ø©: ${project.country === 'egypt' ? 'Ù…ØµØ±' : 'Ù„ÙŠØ¨ÙŠØ§'}
ğŸ“… Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: ${new Date(project.startDate).toLocaleDateString('ar-EG')}`, 'success');
                    } else {
                        showStatus(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: ${data.message}`, 'error');
                    }
                } else {
                    showStatus('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±', 'error');
                }
            } catch (error) {
                showStatus(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: ${error.message}`, 'error');
            }
        }

        async function runFullSystemTest() {
            showStatus('ğŸ”„ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ù†Ø¸Ø§Ù…...', 'info');
            
            // Test login
            const loginSuccess = await testLoginSilent();
            if (!loginSuccess) {
                showStatus('âŒ ÙØ´Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„ - Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'error');
                return;
            }

            try {
                const startTime = performance.now();
                
                // Load all data
                await loadAllData();
                
                const endTime = performance.now();
                const loadTime = Math.round(endTime - startTime);

                const projects = systemData.projects;
                const sections = systemData.sections;
                const spendings = systemData.spendings;
                const dashboard = systemData.dashboard;

                if (projects.length > 0 && sections.length > 0 && spendings.length > 0) {
                    updateStats();
                    
                    const totalBudget = projects.reduce((sum, p) => sum + p.budget, 0);
                    const totalSpent = spendings.reduce((sum, s) => sum + s.amount, 0);
                    const egyptProjects = projects.filter(p => p.country === 'egypt').length;
                    const libyaProjects = projects.filter(p => p.country === 'libya').length;
                    const activeProjects = projects.filter(p => p.status === 'in-progress').length;
                    const completedProjects = projects.filter(p => p.status === 'completed').length;
                    
                    showStatus(`ğŸ‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„ Ù…ÙƒØªÙ…Ù„ Ø¨Ù†Ø¬Ø§Ø­!

âš¡ Ø§Ù„Ø£Ø¯Ø§Ø¡:
â€¢ Ø²Ù…Ù† Ø§Ù„ØªØ­Ù…ÙŠÙ„: ${loadTime} Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©
â€¢ Ø³Ø±Ø¹Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: ${loadTime < 1000 ? 'Ù…Ù…ØªØ§Ø²Ø©' : loadTime < 3000 ? 'Ø¬ÙŠØ¯Ø©' : 'Ø¨Ø·ÙŠØ¦Ø©'}

ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…:
â€¢ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹: ${projects.length} (Ù…ØµØ±: ${egyptProjects}, Ù„ÙŠØ¨ÙŠØ§: ${libyaProjects})
â€¢ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…: ${sections.length}
â€¢ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: ${spendings.length}
â€¢ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: ${systemData.users.length}

ğŸ’° Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ:
â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©: ${(totalBudget / 1000000).toFixed(1)} Ù…Ù„ÙŠÙˆÙ†
â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØµØ±Ù: ${(totalSpent / 1000000).toFixed(1)} Ù…Ù„ÙŠÙˆÙ†
â€¢ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${((totalBudget - totalSpent) / 1000000).toFixed(1)} Ù…Ù„ÙŠÙˆÙ†
â€¢ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†ÙØ§Ù‚: ${((totalSpent / totalBudget) * 100).toFixed(1)}%

ğŸ“ˆ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹:
â€¢ Ø§Ù„Ù†Ø´Ø·Ø©: ${activeProjects}
â€¢ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©: ${completedProjects}
â€¢ Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚Ø¯Ù…: ${Math.round(projects.reduce((sum, p) => sum + p.progress, 0) / projects.length)}%

âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ø«Ø§Ù„ÙŠ!
âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠ!`, 'success');
                } else {
                    showStatus('âŒ Ø¨Ø¹Ø¶ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ù„Ø§ ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­', 'error');
                }
            } catch (error) {
                showStatus(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„: ${error.message}`, 'error');
            }
        }

        async function runPerformanceTest() {
            if (!authToken) {
                showStatus('âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }

            showStatus('âš¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡...', 'info');

            const tests = [
                { name: 'Projects API', url: '/api/projects' },
                { name: 'Sections API', url: '/api/sections' },
                { name: 'Spendings API', url: '/api/spendings' },
                { name: 'Dashboard API', url: '/api/dashboard' },
                { name: 'Users API', url: '/api/users' }
            ];

            let results = [];

            for (const test of tests) {
                const startTime = performance.now();
                try {
                    const response = await fetch(`http://localhost:5000${test.url}`, {
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });
                    const endTime = performance.now();
                    const duration = Math.round(endTime - startTime);
                    
                    results.push({
                        name: test.name,
                        duration: duration,
                        status: response.ok ? 'Ù†Ø¬Ø­' : 'ÙØ´Ù„',
                        statusCode: response.status
                    });
                } catch (error) {
                    results.push({
                        name: test.name,
                        duration: 'Ø®Ø·Ø£',
                        status: 'ÙØ´Ù„',
                        error: error.message
                    });
                }
            }

            const avgTime = results
                .filter(r => typeof r.duration === 'number')
                .reduce((sum, r) => sum + r.duration, 0) / results.length;

            showStatus(`âš¡ Ù†ØªØ§Ø¦Ø¬ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡:

${results.map(r => `â€¢ ${r.name}: ${r.duration}${typeof r.duration === 'number' ? ' Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©' : ''} (${r.status})`).join('\n')}

ğŸ“Š Ø§Ù„Ù…Ù„Ø®Øµ:
â€¢ Ù…ØªÙˆØ³Ø· Ø²Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: ${Math.round(avgTime)} Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©
â€¢ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ${avgTime < 500 ? 'ğŸŸ¢ Ù…Ù…ØªØ§Ø²' : avgTime < 1000 ? 'ğŸŸ¡ Ø¬ÙŠØ¯' : 'ğŸ”´ Ø¨Ø·ÙŠØ¡'}
â€¢ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù†Ø§Ø¬Ø­Ø©: ${results.filter(r => r.status === 'Ù†Ø¬Ø­').length}/${results.length}`, 'success');
        }

        function showProjectsTable(projects) {
            const tableContainer = document.getElementById('detailsTable');
            const tableHeader = document.getElementById('tableHeader');
            const tableBody = document.getElementById('tableBody');
            
            tableHeader.innerHTML = `
                <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th>
                <th>Ø§Ù„Ø¯ÙˆÙ„Ø©</th>
                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                <th>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© (Ù…Ù„ÙŠÙˆÙ†)</th>
                <th>Ø§Ù„ØªÙ‚Ø¯Ù…</th>
                <th>Ø§Ù„Ù…Ø¯ÙŠØ±</th>
            `;
            
            tableBody.innerHTML = projects.map(project => `
                <tr>
                    <td>${project.name}</td>
                    <td>${project.country === 'egypt' ? 'ğŸ‡ªğŸ‡¬ Ù…ØµØ±' : 'ğŸ‡±ğŸ‡¾ Ù„ÙŠØ¨ÙŠØ§'}</td>
                    <td>${project.status === 'in-progress' ? 'ğŸ”„ Ø¬Ø§Ø±ÙŠ' : 'âœ… Ù…ÙƒØªÙ…Ù„'}</td>
                    <td>${(project.budget / 1000000).toFixed(1)}</td>
                    <td>${project.progress}%</td>
                    <td>${project.manager}</td>
                </tr>
            `).join('');
            
            tableContainer.style.display = 'block';
        }

        // Add more test functions following the same pattern...
        async function testSections() {
            if (!authToken) {
                showStatus('âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }

            try {
                showStatus('ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…...', 'info');
                
                const response = await fetch('http://localhost:5000/api/sections', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();
                
                if (response.ok && data.success) {
                    const sections = data.data;
                    showStatus(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­!
Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…: ${sections.length}

Ø£Ù…Ø«Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…:
${sections.slice(0, 3).map(s => `â€¢ ${s.name} - ${s.progress}% (${(s.budget / 1000000).toFixed(1)} Ù…Ù„ÙŠÙˆÙ†)`).join('\n')}`, 'success');
                } else {
                    showStatus(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…: ${data.message}`, 'error');
                }
            } catch (error) {
                showStatus(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ù…: ${error.message}`, 'error');
            }
        }

        async function testSpendings() {
            if (!authToken) {
                showStatus('âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }

            try {
                showStatus('ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª...', 'info');
                
                const response = await fetch('http://localhost:5000/api/spendings', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();
                
                if (response.ok && data.success) {
                    const spendings = data.data;
                    const totalSpent = spendings.reduce((sum, s) => sum + s.amount, 0);
                    showStatus(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­!
Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: ${spendings.length}
Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØµØ±Ù: ${(totalSpent / 1000000).toFixed(1)} Ù…Ù„ÙŠÙˆÙ† Ø¬.Ù…

Ø£Ù…Ø«Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª:
${spendings.slice(0, 3).map(s => `â€¢ ${s.description} - ${(s.amount / 1000).toFixed(0)} Ø£Ù„Ù (${s.category})`).join('\n')}`, 'success');
                } else {
                    showStatus(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: ${data.message}`, 'error');
                }
            } catch (error) {
                showStatus(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: ${error.message}`, 'error');
            }
        }

        function clearTokens() {
            authToken = '';
            localStorage.clear();
            sessionStorage.clear();
            showStatus('âœ… ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆÙƒÙŠÙ†Ø§Øª', 'success');
            updateHealthCard('authHealth', 'warning', 'âš ï¸ ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©');
        }

        function openMainApp() {
            window.open('http://localhost:3000', '_blank');
        }

        // Additional utility functions can be added here...
    </script>
</body>
</html>
